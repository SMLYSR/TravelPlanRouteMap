# 需求文档：AI旅行路线规划应用

## 简介

AI旅行路线规划应用是一个基于iOS的Swift应用，旨在帮助用户根据输入的旅行目的地和景点，智能规划游览顺序和路线，并推荐合适的住宿区域。应用通过AI Agent实现路线规划逻辑，并使用高德地图SDK进行可视化展示。

## 术语表

- **系统（System）**: AI旅行路线规划应用
- **用户（User）**: 使用应用规划旅行路线的人
- **景点（Attraction）**: 用户想要游览的目的地点
- **路线（Route）**: 连接多个景点的游览顺序和路径
- **住宿区域（Accommodation_Zone）**: 基于路线规划推荐的住宿范围
- **出行方式（Travel_Mode）**: 用户的交通方式（步行、公共交通或自驾）
- **AI_Agent**: 负责路线规划和优化的AI智能体
- **地图SDK（Map_SDK）**: 高德地图轻量版SDK（https://lbs.amap.com/api/lightweight-ios-sdk/guide/create-map/show-map）
- **提示词模块（Prompt_Module）**: 管理与AI交互的提示词的独立模块

## 需求

### 需求 1：目的地输入

**用户故事：** 作为用户，我想输入旅行目的地，以便系统能够确定地图显示区域和规划范围。

#### 验收标准

1. 当用户启动应用时，系统应显示目的地输入界面
2. 当用户输入目的地名称时，系统应验证输入不为空
3. 当用户提交有效目的地时，系统应保存目的地信息并确定地图显示区域
4. 当用户输入的目的地无法识别时，系统应提示用户重新输入
5. 用户点击输入的目的地和景点需要通过高德获取数据供用户选择，防止用户输入非法数据

### 需求 2：出行方式选择

**用户故事：** 作为用户，我想选择出行方式（步行、公共交通或自驾），以便系统能够根据不同交通方式优化路线规划。

#### 验收标准

1. 当用户进入出行方式选择界面时，系统应提供"步行"、"公共交通"和"自驾"三个选项
2. 当用户选择出行方式时，系统应保存该选择
3. 当用户跳过出行方式选择时，系统应使用默认规划策略继续流程（默认自驾）
4. 当用户选择"公共交通"时，AI_Agent应在路线规划中优先考虑公交站点和地铁站的便利性
5. 当用户选择"自驾"时，AI_Agent应在路线规划中优先考虑停车便利性和驾驶距离

### 需求 3：景点输入

**用户故事：** 作为用户，我想输入想要游览的景点（最多10个），以便系统能够为我规划游览路线。

#### 验收标准

1. 当用户进入景点输入界面时，系统应提供添加景点的功能
2. 当用户添加景点时，系统应验证景点名称不为空
3. 当用户尝试添加第11个景点时，系统应阻止添加并提示"最多支持10个景点"
4. 当用户提交景点列表时，系统应验证至少有2个景点
5. 当景点少于2个时，系统应提示用户"至少需要2个景点才能规划路线"
6. 在用户输入景点后，可通过高德sdk获取真实地区名称信息供用户选择，输入框支持模糊搜索，防止用户输入不合法景点

### 需求 4：AI路线规划

**用户故事：** 作为用户，我想系统根据我输入的景点智能规划游览顺序和路线，以便我能够高效游览，旅行动线流畅，避免走冤枉路、回头路。

#### 验收标准

1. 当用户提交景点列表后，AI_Agent应根据各个景点位置、用户选择的出行方式计算最优游览顺序
2. 当规划路线时，AI_Agent应最小化总行程距离和回头路
3. 当用户提供了出行方式时，AI_Agent应根据出行方式优化路线（公共交通考虑换乘便利性，自驾考虑驾驶距离）
4. 当路线规划完成时，系统应生成包含景点顺序、路线路径和预计游玩天数的规划结果
5. 当规划失败时，系统应向用户显示错误信息并允许重新规划

### 需求 5：推荐游玩天数

**用户故事：** 作为用户，我想系统根据景点数量和路线距离推荐游玩天数，以便我合理安排行程。

#### 验收标准

1. 当路线规划完成时，AI_Agent应根据景点数量和总路程计算推荐游玩天数
2. 当景点数量为1-2个且总路程较短时，系统应推荐1天
3. 当景点数量为3-5个或总路程较长时，系统应推荐2-3天
4. 当景点数量为6-10个时，系统应推荐5-7天
5. 当显示规划结果时，系统应清晰展示推荐的游玩天数
6. 注意：推荐游玩天数时需要合理安排距离，单个景点所需时间等总和因素，不能强行凑天或凑个数

### 需求 6：住宿区域推荐

**用户故事：** 作为用户，我想系统根据规划的路线推荐住宿区域，以便我选择顺路、高效的住宿位置。

#### 验收标准

1. 当路线规划完成时，AI_Agent应根据景点分布和路线规划推荐住宿区域
2. 当推荐游玩天数大于1天时，系统应为每天推荐一个住宿区域
3. 当推荐住宿区域时，AI_Agent应优先选择靠近当天最后一个景点或第二天第一个景点的区域
4. 当推荐住宿区域时，AI_Agent应考虑交通便利性和景点覆盖范围
5. 当显示住宿推荐时，系统应在地图上标注推荐的住宿区域范围
6. 在推荐住宿区域满足以上要求的同时，可以结合用户选择的出行方式将推荐范围框定在固定范围内，步行或公共交通控制在：1-3km内，自驾控制在3-5km内

### 需求 7：地图可视化展示

**用户故事：** 作为用户，我想在地图上看到规划的路线、景点标记和住宿区域，以便直观了解整个行程安排。

#### 验收标准

1. 当路线规划完成时，系统应使用高德地图SDK在地图上显示所有景点
2. 当显示景点时，系统应使用标记（Marker）突出显示每个景点，并按游览顺序编号
3. 当显示路线时，系统应在地图上绘制连接景点的路径线
4. 当显示住宿区域时，系统应在地图上使用区域标注（如圆形或多边形）标记推荐的住宿范围
5. 当地图加载完成时，系统应自动调整地图视野以显示所有景点和路线
6. 整个程序内嵌高德地图的SDK，所有与地图显示，位置信息和景点间规划线路的能力均使用高德地图，高德地图SDK文档：https://lbs.amap.com/api/ios-sdk/summary

### 需求 8：提示词模块管理

**用户故事：** 作为开发者，我想将与AI交互的提示词单独管理，以便于维护和优化AI规划效果。并将AI链接交互的模块单独维护方便后期从客户端迁移至服务端，支持AI接口格式为opneai接口格式

#### 验收标准

1. 系统应创建独立的提示词模块（Prompt_Module）来管理所有AI提示词
2. 当AI_Agent需要规划路线时，系统应从Prompt_Module获取路线规划提示词
3. 当AI_Agent需要推荐住宿时，系统应从Prompt_Module获取住宿推荐提示词
4. 当提示词需要更新时，系统应只需修改Prompt_Module而不影响其他代码
5. 提示词模块应包含以下提示词类型：路线规划、住宿推荐、天数计算

### 需求 9：用户界面设计

**用户故事：** 作为用户，我想使用简洁流畅的界面，以便获得良好的使用体验。

#### 验收标准

1. 系统应使用圆角扁平的简洁设计风格
2. 系统应使用浅蓝色和白色作为主要配色方案
3. 当用户进行输入或操作时，系统应提供流畅的动画过渡效果
4. 当AI正在规划路线时，系统应显示加载动画和进度提示
5. 当显示规划结果时，系统应使用清晰的视觉层次展示信息

### 需求 10：数据持久化

**用户故事：** 作为用户，我想系统能够保存我的规划结果，以便我可以随时查看。
目前数据均存储在客户端本地，对规划结果维护最基础的增删改查功能

#### 验收标准

1. 当路线规划完成时，系统应将规划结果保存到本地存储
2. 当用户重新打开应用时，系统应显示最近的规划结果
3. 当用户创建新规划时，系统应保存历史规划记录
4. 当用户查看历史记录时，系统应显示规划的目的地、景点数量和创建时间
5. 当用户删除历史记录时，系统应从本地存储中移除对应数据

### 需求 11：错误处理

**用户故事：** 作为用户，我想在出现错误时得到清晰的提示，以便我知道如何解决问题。

#### 验收标准

1. 当网络连接失败时，系统应显示"网络连接失败，请检查网络设置"提示
2. 当地图SDK加载失败时，系统应显示"地图加载失败，请稍后重试"提示
3. 当AI规划超时时，系统应显示"规划超时，请重试"提示
4. 当用户输入无效数据时，系统应在输入框旁显示具体的错误原因
5. 当发生错误时，系统应提供"重试"或"返回"操作选项

## 约束条件

1. 系统不应主动推荐景点，只根据用户输入的景点进行规划
2. 系统必须使用高德地图轻量版iOS SDK进行地图展示
3. 与地图sdk相关的用法、错误都优先在官方文档中找解决：https://lbs.amap.com/api/ios-sdk/summary
4. 景点数量限制为最多10个
5. 系统必须在iOS平台上运行
